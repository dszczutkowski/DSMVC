DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'DSMVC.Models.DSMVCContext'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201601142023311_InitialCreate'
BEGIN
    CREATE TABLE [dbo].[Meals] (
        [MealID] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max) NOT NULL,
        [Price] [float] NOT NULL,
        CONSTRAINT [PK_dbo.Meals] PRIMARY KEY ([MealID])
    )
    CREATE TABLE [dbo].[Orders] (
        [OrderID] [int] NOT NULL IDENTITY,
        [MealID] [int] NOT NULL,
        [SeatNumber] [int] NOT NULL,
        [PaymentMethod] [nvarchar](max) NOT NULL,
        CONSTRAINT [PK_dbo.Orders] PRIMARY KEY ([OrderID])
    )
    CREATE INDEX [IX_MealID] ON [dbo].[Orders]([MealID])
    ALTER TABLE [dbo].[Orders] ADD CONSTRAINT [FK_dbo.Orders_dbo.Meals_MealID] FOREIGN KEY ([MealID]) REFERENCES [dbo].[Meals] ([MealID]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201601142023311_InitialCreate', N'DSMVC.Models.DSMVCContext',  0x1F8B0800000000000400D559DB6EE336107D2FD07F10F4D416592B171468037B17A99D1446D749102541DF025A1ADB44295225A9C046D12FEB433FA9BFD0A16E9644C9B75CB64580C0A6660E8733678633F23F7FFDDDFFB48C98F30C5251C107EE49EFD875800722A47C3E70133DFBF083FBE9E3D75FF52FC368E93C167267460E35B91AB80BADE373CF53C10222A27A110DA45062A67B81883C120AEFF4F8F847EFE4C403847011CB71FA7709D73482F40B7E1D0A1E40AC13C2262204A6F2757CE2A7A8CE358940C52480813BF2278FC35E26E73A178C12B4C10736731DC2B9D044A385E70F0A7C2D059FFB312E1076BF8A01E5668429C82D3F5F8BEF7A88E35373086FAD58400589D222DA13F0E42CF78AD7543FC8B76EE935F4DB25FA57AFCCA953DF0DDC0910E63ACD8DCE874C1AA1BA5B7B46F8C849978ECAA02337CCDF91334C984E240C38245A1AC1DB64CA68F00BACEEC56FC0073C61AC6A0C9A83CF6A0BB8742B450C52AFEE605631713C721DAFAEEB35954BD5865E769031D767A7AE738D4690298332E69543FB5A48F8193848A221BC255A83C4908D4348BD6659D0D8CFFC2F76439261A6B8CE842C3F039FEBC5C0FD1E53E38A2E212C1672031E38C5BC421D2D13683170F3A6B79206E5AE23811EDF01E39A3CD3797AE606DA8D0C31AAAE73072C7DAC1634CEB2A8973E7ACAE8722545742758A190AE3EDD1339078DA608EB912F121934CCE87B6B2E6E64688AB3334553E9F7E768BAED21242D15DF8BA5BB65C5660C1F88BE4EA2A989CB4B706EC92A42AB27A01722DC903AF8F15572A793F719AD0F617D41ED16D61709B10BEB2F9412014D77AF1223DBB97E884B1E3ADD66642E2C4D473722E3698C1CC75D07EE77964F5AE1CA5C5EC3653EA8A39DB8CDCCB8E12360A0C1B908B2FB6E485440423B14E887B0BE82C904D2709830BCF715A627E5DACE3CCA031A13D6697343638F1BC55855E2379F8C20066E52ACD3F72FDBB8C46FB8699B57FA5E853A761D451D8D1A207303D2BA681661A95B6A2AB647795955794E35C962407DD095F3E075B1E6748D2C16D3EACAC5656369E7CC6DA857CED9C0C8F3B32260676FD3E11BB3A8B4746DA415B18D795301C85DD4A47FFD342D15A28CDCBAE9F5B2AEB7E88EBD8EF6B83F21718C25B4D22EE72B8E9FF5CAC30FFEFEAD64946178816AE9284B6BCB9DF0962273683CC5ADD1D22B2A951E114DA6C414E961185962359E76D0A8D8AA4A453B4A05B70A69F3B9920BD5D6B6258573AD2B3C8BB9A9D2634123BAB65A3AA0104664C7DD3B142C89F8E692D08D92F599558C6C657784BC69AC42E44B3646DF6BF8C02A5D968FAD4A5F0FD84EE1CCF3EEE078663564FF8076E87579B26CDFAABEEC6806DF9E19D5BEAC8A545DDF8325F5EEACC696FAA377668D55229B22E5EE65A96C94C47E5E9EB6BF56B0EA5526E23AE8AC671A9A5AE5AF9486A867047AFEEF6CC8289E772D30219CCE40E96CC07071BE3F6DBC9FF8EFBC2BF0940AD90E2F0CBED8144F8D67B74E407B8E21D5C19D3F13192C88B446F797CCE5332688DE02B1E73CFC0567D43789414B98ADEE748C0DF272E0FE91AA9C3BE35F9F32AD2327B5F0DC3976FE7C855936DDFC3526D9824BDF4464F9ED81E13F6830CCFAE1F71CDE1ADDF02183E841F35F47DBF67623DFFF63CCB3BBECED735CE71897DD7803379C0A8C6BC6E0F6A9A675C2EB1EF0DA80DBE7AD371BFEAA075F37F45BA73D7B447C9B09CF6E53902A95DF4890A38ACED710E617130E418D24A5CC98CF44C1D5864585885594350991411752D31909343E0E40A9F4F5DC2361098A5C62E50CC7FC26D171A2F1C8104D59ED1DA4E1FCA6FDD331B66E73FF264E5FC3BDC611D04C8A47801BFE53425958DA7DD552823B204C32E5379D89A53637DE7C55225D0BBE2350EEBEB206DC431433045337DC27CF70886D0F0A3EC39C04ABA2DBEC06D91E88BADBFB234AE692442AC758EBE357E470182D3FFE0BE2DE8F192A1C0000 , N'6.1.3-40302')
END

